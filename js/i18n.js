// 国际化翻译配置
const translations = {
    zh: {
        header: {
            firmName: '吕昕橦律师事务所'
        },
        nav: {
            about: '关于我们',
            services: '业务领域',
            appointment: '案件咨询',
            contact: '联系方式',
            joinus: '加入我们'
        },
        about: {
            title: '关于我们',
            firmName: '吕昕橦律师事务所',
            paragraph1: '吕昕橦律师事务所由一支资深且高素质的专业律师团队组成。事务所律师均毕业于美国知名法学院，并取得法律博士（Juris Doctor）学位，精通中英双语，熟悉美国法律体系，具备扎实的法律理论基础与实践能力。本所律师曾在政府机构、司法部门、国际知名律师事务所，以及大型企业从事法律工作，在各自专业领域累积了丰富的执业经验与成功案例。',
            paragraph2: '本所业务范围广泛，涵盖民事诉讼、婚姻家事、刑事辩护、移民法律、房地产交易与纠纷、人身伤害、知识产权、商业法律等多个领域。',
            paragraph3: '我们秉承"精准研判、追求极致"的执业理念，恪守独立、审慎的职业操守，以匠心精神深耕法律领域。依托专业严谨的律师团队、前瞻性的法律思维及卓越的复杂问题解决能力，致力于为客户提供全方位、全流程、高质量的法律解决方案，维护客户的合法权益，守护每一份信任与委托。',
            value1: '专业',
            value2: '专注',
            value3: '高效',
            value4: '信赖'
        },
        services: {
            title: '业务领域',
            civil: '民事诉讼',
            immigration: '移民法律',
            familylaw: '婚姻家事',
            realproperty: '房地产法律',
            personalinjury: '人身伤害',
            criminal: '刑事辩护',
            business: '商业法律',
            ip: '知识产权'
        },
        appointment: {
            title: '预约律师咨询',
            heading: '免费案件评估',
            description: '请填写以下信息，我们的律师团队将在24小时内与您联系，为您提供免费的案件初步评估和法律咨询建议。',
            name: '姓名',
            phone: '联系电话',
            email: '电子邮箱',
            caseType: '案件类型',
            selectCase: '请选择案件类型',
            message: '案件简述',
            messagePlaceholder: '请简要描述您的法律问题或案件情况...',
            submit: '提交预约申请',
            other: '其他'
        },
        footer: {
            title: '联系我们',
            availability: '24/7',
            subtitle: '如果您有任何法律需求，请随时与我们联系',
            firmName: '吕昕橦律师事务所',
            phone: '电话',
            address: '地址',
            email: '邮箱',
            wechat: '微信',
            officeHours: '办公时间',
            officeHoursContent: '周一至周六 9:00 AM - 5:30 PM<br>周日（仅限预约）',
            wechatQRCode: '微信二维码',
            mapTitle: '办公地点'
        },
        joinus: {
            title: '加入我们',
            positions: '招聘职位：Law Clerk（法律助理）',
            jobDuties: '工作内容：',
            duty1: '协助律师进行法律检索与材料整理',
            duty2: '起草、整理和校对法律文件',
            duty3: '协助准备法院或移民申请材料',
            duty4: '管理案件档案，与客户或机构沟通',
            duty5: '完成律师交办的其他工作',
            requirements: '岗位要求：',
            requirement1: '毕业于美国法学院（JD优先）',
            requirement2: '中英文读写良好，能够处理双语文件',
            requirement3: '工作认真、细心、有责任感',
            requirement4: '有律所或相关经验',
            workArrangement: '工作安排：',
            location: '工作地点：纽约法拉盛',
            applicationMethod: '申请方式：',
            applicationInfo: '请将简历发送至：catherine.lyu@lyulawpllc.com',
            emailSubject: '邮件标题注明："Law Clerk – 姓名"'
        }
    },
    en: {
        header: {
            firmName: 'The Law Office of X.Lyu,PLLC'
        },
        nav: {
            about: 'About Us',
            services: 'Services',
            appointment: 'Consultation',
            contact: 'Contact',
            joinus: 'Join Us'
        },
        about: {
            title: 'About Us',
            firmName: 'The Law Office of X.Lyu, PLLC',
            paragraph1: 'The Law Office of X. Lyu, PLLC is a bilingual Chinese-English law firm dedicated to serving individuals, families, and businesses in the United States. Our attorneys are graduates of leading U.S. law schools, hold Juris Doctor degrees, and have extensive experience across government, courts, top international law firms, and major corporations.',
            paragraph2: 'We provide legal services in civil litigation, family law, criminal defense, immigration law, real estate transactions and disputes, business and commercial law, personal injury, and intellectual property.',
            paragraph3: 'We believe in precise strategy, exceptional service, and uncompromised professionalism. With a rigorous legal team and strong problem-solving capabilities, we deliver comprehensive and high-quality legal solutions—protecting our clients\' rights and earning their trust with every case.',
            value1: 'Professional Service.',
            value2: 'Dedicated Approach.',
            value3: 'Efficient Results.',
            value4: 'Trusted by Clients.'
        },
        services: {
            title: 'Practice Areas',
            civil: 'Civil Litigation',
            immigration: 'Immigration Law',
            familylaw: 'Family Law',
            realproperty: 'Real Estate Law',
            personalinjury: 'Personal Injury',
            criminal: 'Criminal Defense',
            business: 'Business Law',
            ip: 'Intellectual Property'
        },
        appointment: {
            title: 'Book a Free Attorney Consultation',
            heading: 'Free Case Evaluation',
            description: 'Please fill out the information below, and our legal team will contact you within 24 hours to provide a free preliminary case assessment and legal consultation.',
            name: 'Name',
            phone: 'Phone',
            email: 'Email',
            caseType: 'Case Type',
            selectCase: 'Please select case type',
            message: 'Case Description',
            messagePlaceholder: 'Please briefly describe your legal issue or case...',
            submit: 'Submit Appointment',
            other: 'Other'
        },
        footer: {
            title: 'Contact Us',
            availability: '24/7',
            subtitle: 'If you require any legal assistance, please do not hesitate to contact us.',
            firmName: 'The Law Office of X.Lyu,PLLC',
            phone: 'Phone',
            address: 'Address',
            email: 'Email',
            wechat: 'WeChat',
            officeHours: 'Office Hours',
            officeHoursContent: 'Monday - Saturday: 9:00 AM - 5:30 PM<br>Sunday: By Appointment Only',
            wechatQRCode: 'WeChat QR Code',
            mapTitle: 'Office Location'
        },
        joinus: {
            title: 'Join Us',
            positions: 'Position: Law Clerk',
            jobDuties: 'Job Responsibilities:',
            duty1: 'Conduct legal research and assist with document review',
            duty2: 'Draft, organize, and proofread legal documents',
            duty3: 'Assist with preparation and filing of court or immigration applications',
            duty4: 'Maintain case files and communicate with clients or agencies',
            duty5: 'Perform other tasks assigned by supervising attorneys',
            requirements: 'Requirements:',
            requirement1: 'Graduate of a U.S. law school (J.D. preferred)',
            requirement2: 'Strong English and Chinese reading/writing skills; able to work with bilingual documents',
            requirement3: 'Detail-oriented, responsible, and organized',
            requirement4: 'Prior law firm or relevant experience preferred',
            workArrangement: 'Work Arrangement:',
            location: 'Location: Flushing, New York',
            applicationMethod: 'How to Apply:',
            applicationInfo: 'Please send your resume to catherine.lyu@lyulawpllc.com',
            emailSubject: 'Email subject line: "Law Clerk – [Your Name]"'
        }
    }
};

// 获取当前语言（始终从localStorage读取最新值）
function getCurrentLang() {
    return localStorage.getItem('language') || 'zh';
}

// 获取翻译文本
function t(key) {
    const currentLang = getCurrentLang();
    const keys = key.split('.');
    let value = translations[currentLang];

    for (const k of keys) {
        value = value[k];
        if (!value) return key;
    }

    return value;
}

// 切换语言
function switchLanguage(lang) {
    if (lang && (lang === 'zh' || lang === 'en')) {
        localStorage.setItem('language', lang);
        updatePageLanguage();
    }
}

// 更新页面语言
function updatePageLanguage() {
    const currentLang = getCurrentLang();

    // 更新所有带有 data-i18n 属性的元素
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        element.textContent = t(key);
    });

    // 更新HTML内容（支持<br>等标签）
    document.querySelectorAll('[data-i18n-html]').forEach(element => {
        const key = element.getAttribute('data-i18n-html');
        element.innerHTML = t(key);
    });

    // 更新placeholder
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        element.placeholder = t(key);
    });

    // 更新语言选择器状态
    const langZh = document.getElementById('lang-zh');
    const langEn = document.getElementById('lang-en');
    if (langZh && langEn) {
        if (currentLang === 'zh') {
            langZh.classList.add('active');
            langEn.classList.remove('active');
        } else {
            langZh.classList.remove('active');
            langEn.classList.add('active');
        }
    }

    // 触发自定义事件，让其他模块知道语言已切换
    document.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang: currentLang } }));
}

// 页面加载时初始化语言
document.addEventListener('DOMContentLoaded', function() {
    updatePageLanguage();

    // 监听DOM变化，当新内容加载时自动应用语言
    let updateTimeout;
    const observer = new MutationObserver(function(mutations) {
        // 使用防抖避免频繁更新
        clearTimeout(updateTimeout);
        updateTimeout = setTimeout(function() {
            const hasNewContent = mutations.some(mutation =>
                mutation.addedNodes.length > 0 &&
                Array.from(mutation.addedNodes).some(node =>
                    node.nodeType === 1 && // 只处理元素节点
                    (node.querySelector('[data-i18n]') || node.hasAttribute('data-i18n'))
                )
            );
            if (hasNewContent) {
                updatePageLanguage();
            }
        }, 100);
    });

    // 监听整个body的变化
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
});

// 导出到全局
window.t = t;
window.switchLanguage = switchLanguage;
window.getCurrentLang = getCurrentLang;
